<script>
  const SUPABASE_URL = "https://ouqebpzlffeviuaisiqp.supabase.co";
  const SUPABASE_ANON_KEY = "YOUR_ANON_KEY";

  const supabaseClient = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );

  const container = document.getElementById("container");

  function parseHash() {
    const params = new URLSearchParams(window.location.hash.substring(1));
    return {
      access_token: params.get("access_token"),
      refresh_token: params.get("refresh_token"),
      type: params.get("type")
    };
  }

  async function initRecovery() {
    const rawHash = window.location.hash;
    const { access_token, refresh_token, type } = parseHash();

    container.innerHTML = `
      <p><strong>Debug Info:</strong></p>
      <p>Raw Hash: ${rawHash}</p>
      <p>Access Token Present: ${!!access_token}</p>
      <p>Refresh Token Present: ${!!refresh_token}</p>
      <p>Type: ${type}</p>
      <p>Attempting setSession...</p>
    `;

    if (!access_token || !refresh_token || type !== "recovery") {
      container.innerHTML += `<p class="error">Missing required recovery parameters.</p>`;
      return;
    }

    const { data, error } = await supabaseClient.auth.setSession({
      access_token,
      refresh_token
    });

    if (error) {
      container.innerHTML += `<p class="error">setSession Error: ${error.message}</p>`;
      return;
    }

    if (!data?.session) {
      container.innerHTML += `<p class="error">No session returned.</p>`;
      return;
    }

    container.innerHTML += `<p class="success">Session established successfully.</p>`;
  }

  initRecovery();
</script>
