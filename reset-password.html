<script>
  const SUPABASE_URL = "https://ouqebpzlffeviuaisiqp.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im91cWVicHpsZmZldml1YWlzaXFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMzU3NjQsImV4cCI6MjA3MDYxMTc2NH0.Z9m9u5QNVyxagdS1OTGDUHnr4PxIz2QTcZJRcrG8DW4";

  const { createClient } = window.supabase;
const supabase = createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);


  const container = document.getElementById("container");

  function parseHash() {
    const params = new URLSearchParams(window.location.hash.substring(1));
    return {
      access_token: params.get("access_token"),
      refresh_token: params.get("refresh_token"),
      type: params.get("type")
    };
  }

  async function initRecovery() {
    const rawHash = window.location.hash;
    const { access_token, refresh_token, type } = parseHash();

    container.innerHTML = `
      <p><strong>Debug Info:</strong></p>
      <p>Raw Hash: ${rawHash}</p>
      <p>Access Token Present: ${!!access_token}</p>
      <p>Refresh Token Present: ${!!refresh_token}</p>
      <p>Type: ${type}</p>
      <p>Attempting setSession...</p>
    `;

    if (!access_token || !refresh_token || type !== "recovery") {
      container.innerHTML += `<p class="error">Missing required recovery parameters.</p>`;
      return;
    }

    const { data, error } = await supabaseClient.auth.setSession({
      access_token,
      refresh_token
    });

    if (error) {
      container.innerHTML += `<p class="error">setSession Error: ${error.message}</p>`;
      return;
    }

    if (!data?.session) {
      container.innerHTML += `<p class="error">No session returned.</p>`;
      return;
    }

    container.innerHTML += `<p class="success">Session established successfully.</p>`;
  }

  initRecovery();
</script>
